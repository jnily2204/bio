<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeowLink - Bio Platform</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Inter"', '"Be Vietnam Pro"', 'sans-serif'], display: ['"Be Vietnam Pro"', 'sans-serif'] },
                    colors: { brand: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 300: '#fda4af', 400: '#fb7185', 500: '#f43f5e', 600: '#e11d48', 700: '#be123c', 800: '#9f1239', 900: '#881337', 950: '#4c0519' }, dark: { 900: '#0f172a', 800: '#1e293b', 700: '#334155' } },
                    animation: { 'fade-in': 'fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1)', 'slide-up': 'slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1)', 'float': 'float 6s ease-in-out infinite', 'heart-beat': 'heartBeat 1s infinite' },
                    keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }, float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }, heartBeat: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.2)' } } },
                    boxShadow: { 'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)', 'glow': '0 0 15px rgba(225, 29, 72, 0.3)', 'input': '0 0 0 4px rgba(225, 29, 72, 0.1)' }
                }
            }
        }
    </script>

    <style>
        /* Base */
        body { background-color: #f8fafc; min-height: 100vh; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.5); }
        
        /* Gradients & Patterns */
        .mesh-gradient { background-color: #ff9a9e; background-image: radial-gradient(at 40% 20%, hsla(28,100%,74%,1) 0px, transparent 50%), radial-gradient(at 80% 0%, hsla(189,100%,56%,1) 0px, transparent 50%), radial-gradient(at 0% 50%, hsla(340,100%,76%,1) 0px, transparent 50%), radial-gradient(at 80% 50%, hsla(340,100%,77%,1) 0px, transparent 50%); background-size: 150% 150%; animation: meshMove 20s ease infinite alternate; }
        @keyframes meshMove { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }
        .pattern-grid { background-image: radial-gradient(#ffffff 1.5px, transparent 1.5px); background-size: 24px 24px; }

        /* UI Components */
        .input-modern { width: 100%; padding: 14px 16px 14px 44px; background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 0.95rem; color: #1e293b; transition: all 0.2s; }
        .input-modern:focus { border-color: #e11d48; box-shadow: 0 0 0 4px rgba(225, 29, 72, 0.1); outline: none; }
        .input-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; transition: color 0.2s; }
        .input-modern:focus + .input-icon { color: #e11d48; }
        .btn-modern { width: 100%; background: linear-gradient(135deg, #e11d48 0%, #be123c 100%); color: white; padding: 14px; border-radius: 12px; font-weight: 600; transition: all 0.2s; box-shadow: 0 4px 12px rgba(225, 29, 72, 0.2); display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-modern:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(225, 29, 72, 0.3); }
        .auth-switch { background-color: #f1f5f9; padding: 4px; border-radius: 12px; display: flex; }
        .auth-switch-btn { flex: 1; padding: 10px; text-align: center; font-size: 0.9rem; font-weight: 600; border-radius: 8px; color: #64748b; transition: all 0.3s; }
        .auth-switch-btn.active { color: #1e293b; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* --- ANIMATED CAT STYLES --- */
        #cat-container svg { overflow: visible; }
        .cat-paws { 
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy effect */
            transform-box: fill-box;
            transform-origin: center top;
        }
        .cat-pupil { transition: transform 0.1s ease-out; }
        .cat-heart { 
            opacity: 0; 
            transform: scale(0) translateY(10px); 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-origin: center; 
            transform-box: fill-box;
        }
        
        /* State: Loving It (Hands to chest) */
        .loving-it .cat-paws-left { transform: translate(10px, -25px) rotate(30deg); }
        .loving-it .cat-paws-right { transform: translate(-10px, -25px) rotate(-30deg); }
        .loving-it .cat-heart { opacity: 1; transform: scale(1.2) translateY(-5px); animation: heartBeat 1s infinite; }
        
        /* State: Covering Eyes (Hands up high) */
        .covering-eyes .cat-paws-left { transform: translate(12px, -45px) rotate(10deg); }
        .covering-eyes .cat-paws-right { transform: translate(-12px, -45px) rotate(-10deg); }
        
        /* Utils */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .toast { background: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.1); margin-bottom: 12px; border-left: 4px solid #e11d48; animation: slideInRight 0.4s; display: flex; align-items: center; gap: 12px; font-weight: 500; position: fixed; top: 24px; right: 24px; z-index: 10000; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .loader { border: 2px solid #f1f5f9; border-top: 2px solid #e11d48; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none !important; }
    </style>
</head>
<body class="text-slate-800 antialiased">

    <div id="toast-container"></div>

    <div id="app" class="min-h-screen flex flex-col relative">
        
        <!-- AUTH VIEW -->
        <div id="view-auth" class="view-section hidden flex-grow min-h-screen flex flex-col lg:flex-row bg-white animate-fade-in">
            <!-- Left Side -->
            <div class="hidden lg:flex lg:w-1/2 bg-slate-900 relative overflow-hidden flex-col justify-between p-12 text-white">
                <div class="absolute inset-0 pattern-grid opacity-10"></div>
                <div class="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-brand-600 rounded-full mix-blend-screen filter blur-[100px] opacity-20 animate-float"></div>
                <div class="absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-600 rounded-full mix-blend-screen filter blur-[100px] opacity-20 animate-float" style="animation-delay: -3s"></div>
                <div class="relative z-10 flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 bg-white/10 backdrop-blur rounded-xl flex items-center justify-center border border-white/20"><i class="fas fa-cat text-brand-400 text-xl"></i></div>
                    <span class="font-display font-bold text-2xl tracking-tight">MeowLink</span>
                </div>
                <div class="relative z-10 max-w-md">
                    <h2 class="text-5xl font-display font-bold leading-tight mb-6">M·ªçi li√™n k·∫øt.<br>M·ªôt n∆°i duy nh·∫•t.</h2>
                    <p class="text-slate-400 text-lg leading-relaxed mb-8">T·∫°o trang h·ªì s∆° c√° nh√¢n ƒë·∫πp m·∫Øt ch·ªâ trong v√†i ph√∫t.</p>
                    <div class="flex flex-wrap gap-3">
                        <span class="px-4 py-2 bg-white/10 backdrop-blur rounded-full text-sm font-medium border border-white/10">‚ú® T√πy bi·∫øn</span>
                        <span class="px-4 py-2 bg-white/10 backdrop-blur rounded-full text-sm font-medium border border-white/10">üöÄ T·ªëc ƒë·ªô cao</span>
                    </div>
                </div>
                <div class="relative z-10 text-sm text-slate-500 font-medium">¬© 2024 MeowLink Inc.</div>
            </div>

            <!-- Right Side (Auth Form) -->
            <div class="w-full lg:w-1/2 flex flex-col justify-center items-center p-6 sm:p-12 relative bg-white">
                <div class="w-full max-w-[400px] mx-auto animate-slide-up flex flex-col items-center">
                    
                    <!-- NEW SUPER CUTE CAT SVG -->
                    <div class="flex justify-center mb-8 h-32 relative" id="cat-container">
                        <svg viewBox="0 0 120 110" class="w-40 h-40">
                            <!-- Ears -->
                            <path d="M30 35 L15 5 Q35 10 45 30 Z" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2" stroke-linejoin="round"/>
                            <path d="M90 35 L105 5 Q85 10 75 30 Z" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2" stroke-linejoin="round"/>
                            
                            <!-- Head Base -->
                            <ellipse cx="60" cy="60" rx="45" ry="38" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2.5"/>
                            
                            <!-- Cheeks -->
                            <ellipse cx="35" cy="70" rx="6" ry="4" fill="#fda4af" opacity="0.6"/>
                            <ellipse cx="85" cy="70" rx="6" ry="4" fill="#fda4af" opacity="0.6"/>

                            <!-- Eyes Group -->
                            <g class="cat-eyes">
                                <!-- Left Eye -->
                                <circle cx="40" cy="55" r="10" fill="white" stroke="#334155" stroke-width="2"/>
                                <circle id="pupil-left" class="cat-pupil" cx="40" cy="55" r="6" fill="#1e293b"/>
                                <circle cx="43" cy="52" r="2" fill="white"/> <!-- Highlight -->
                                
                                <!-- Right Eye -->
                                <circle cx="80" cy="55" r="10" fill="white" stroke="#334155" stroke-width="2"/>
                                <circle id="pupil-right" class="cat-pupil" cx="80" cy="55" r="6" fill="#1e293b"/>
                                <circle cx="83" cy="52" r="2" fill="white"/> <!-- Highlight -->
                            </g>

                            <!-- Mouth & Nose -->
                            <path d="M57 65 L63 65 L60 68 Z" fill="#fda4af"/>
                            <path d="M60 68 Q50 77 45 70 M60 68 Q70 77 75 70" fill="none" stroke="#334155" stroke-width="1.5" stroke-linecap="round"/>

                            <!-- Heart (Like Button) -->
                            <path class="cat-heart" d="M60 70 C60 60 52 60 52 67 C52 75 60 80 60 80 C60 80 68 75 68 67 C68 60 60 60 60 70" fill="#f43f5e" stroke="#be123c" stroke-width="1"/>

                            <!-- Paws (Initially hidden below) -->
                            <g>
                                <!-- Left Paw -->
                                <ellipse class="cat-paws cat-paws-left" cx="25" cy="95" rx="10" ry="12" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2"/>
                                <!-- Right Paw -->
                                <ellipse class="cat-paws cat-paws-right" cx="95" cy="95" rx="10" ry="12" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2"/>
                            </g>
                        </svg>
                    </div>

                    <div class="w-full">
                        <div class="text-center lg:text-left mb-6">
                            <h1 class="text-3xl font-display font-bold text-slate-900 mb-1">Xin ch√†o üëã</h1>
                            <p class="text-slate-500 text-sm">Nh·∫≠p th√¥ng tin c·ªßa b·∫°n ƒë·ªÉ ti·∫øp t·ª•c.</p>
                        </div>

                        <div class="auth-switch mb-6">
                            <button onclick="toggleAuthMode('login')" id="tab-login" class="auth-switch-btn active">ƒêƒÉng nh·∫≠p</button>
                            <button onclick="toggleAuthMode('register')" id="tab-register" class="auth-switch-btn">T·∫°o t√†i kho·∫£n</button>
                        </div>

                        <!-- Login Form -->
                        <form id="form-login" onsubmit="handleLogin(event)" class="space-y-4">
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-700 uppercase">Email</label>
                                <div class="input-group">
                                    <input type="email" id="login-email" placeholder="name@example.com" class="input-modern track-input" required>
                                    <i class="fas fa-envelope input-icon"></i>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-700 uppercase">M·∫≠t kh·∫©u</label>
                                <div class="input-group">
                                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input-modern pass-input" required>
                                    <i class="fas fa-lock input-icon"></i>
                                </div>
                            </div>
                            <button type="submit" class="btn-modern mt-2">
                                <span>ƒêƒÉng nh·∫≠p</span> 
                                <div class="loader hidden border-white/30 border-t-white" id="login-loader"></div>
                            </button>
                        </form>

                        <!-- Register Form -->
                        <form id="form-register" onsubmit="handleRegister(event)" class="space-y-4 hidden">
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-700 uppercase">Email</label>
                                <div class="input-group">
                                    <input type="email" id="reg-email" placeholder="name@example.com" class="input-modern track-input" required>
                                    <i class="fas fa-envelope input-icon"></i>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-bold text-slate-700 uppercase">M·∫≠t kh·∫©u</label>
                                <div class="input-group">
                                    <input type="password" id="reg-password" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±" class="input-modern pass-input" minlength="6" required>
                                    <i class="fas fa-key input-icon"></i>
                                </div>
                            </div>
                            <button type="submit" class="btn-modern mt-2">
                                <span>ƒêƒÉng k√Ω mi·ªÖn ph√≠</span>
                                <div class="loader hidden border-white/30 border-t-white" id="reg-loader"></div>
                            </button>
                        </form>
                    </div>

                </div>
            </div>
        </div>

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view-section hidden flex-grow bg-slate-50">
            <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-30">
                <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
                    <div class="flex items-center gap-2 text-brand-600">
                        <i class="fas fa-cat text-2xl"></i>
                        <span class="font-display font-bold text-lg tracking-tight text-slate-900">MeowLink</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span id="user-email-display" class="text-sm font-medium text-slate-700 hidden sm:block"></span>
                        <button onclick="handleLogout()" class="text-sm text-slate-500 hover:text-red-600 font-medium transition-colors"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                </div>
            </nav>
            <div class="max-w-6xl mx-auto p-6 md:p-8 animate-fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                    <h2 class="text-3xl font-display font-bold text-slate-900">Trang Bio C·ªßa B·∫°n</h2>
                    <button onclick="openCreateModal()" class="bg-slate-900 text-white px-6 py-3 rounded-xl hover:bg-slate-800 transition font-bold text-sm shadow-lg"><i class="fas fa-plus"></i> T·∫°o Trang M·ªõi</button>
                </div>
                <div id="bio-list" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
                <div id="dashboard-loader" class="flex justify-center mt-20 hidden"><div class="loader w-8 h-8 !border-slate-200 !border-t-brand-600"></div></div>
            </div>
        </div>

        <!-- EDITOR VIEW -->
        <div id="view-editor" class="view-section hidden flex-grow bg-slate-100 flex flex-col md:flex-row h-screen overflow-hidden">
            <div class="w-full md:w-[400px] lg:w-[450px] bg-white border-r border-slate-200 flex flex-col h-full z-20 shadow-2xl animate-slide-right">
                <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-white z-10">
                    <button onclick="goToDashboard()" class="text-slate-500 hover:text-slate-900 font-semibold flex items-center gap-2"><i class="fas fa-chevron-left"></i> Quay l·∫°i</button>
                    <button onclick="saveCurrentBio()" class="bg-brand-600 text-white px-5 py-2 rounded-lg font-bold hover:bg-brand-700 shadow-md flex items-center gap-2"><i class="fas fa-save"></i> L∆∞u</button>
                </div>
                <div class="overflow-y-auto flex-1 p-6 space-y-8 custom-scrollbar">
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-slate-400 uppercase">Public URL</span>
                            <a id="live-preview-link" href="#" target="_blank" class="text-brand-600 text-xs font-bold hover:underline">M·ªü tab m·ªõi <i class="fas fa-external-link-alt"></i></a>
                        </div>
                        <div class="flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-slate-200 text-sm text-slate-600 font-mono truncate">
                            <i class="fas fa-globe text-slate-300"></i><span id="editor-url-display" class="truncate">...</span>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <h3 class="font-bold text-slate-900 text-sm flex items-center gap-2"><i class="fas fa-user-circle text-brand-500"></i> Th√¥ng tin h·ªì s∆°</h3>
                        <div class="space-y-4 pl-2 border-l-2 border-slate-100">
                            <div><label class="block text-xs font-medium text-slate-500 mb-1.5">·∫¢nh ƒë·∫°i di·ªán (URL)</label><input type="text" id="ed-avatar" oninput="updatePreview()" class="input-modern !py-2"></div>
                            <div><label class="block text-xs font-medium text-slate-500 mb-1.5">T√™n hi·ªÉn th·ªã</label><input type="text" id="ed-name" oninput="updatePreview()" class="input-modern !py-2"></div>
                            <div><label class="block text-xs font-medium text-slate-500 mb-1.5">M√¥ t·∫£ ng·∫Øn</label><textarea id="ed-bio" oninput="updatePreview()" rows="2" class="input-modern !py-2 resize-none"></textarea></div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center"><h3 class="font-bold text-slate-900 text-sm flex items-center gap-2"><i class="fas fa-link text-brand-500"></i> Li√™n k·∫øt</h3><button onclick="addLinkItem()" class="text-xs bg-slate-900 text-white px-3 py-1.5 rounded-lg font-bold shadow-sm">+ Th√™m</button></div>
                        <div id="ed-links-list" class="space-y-3 pb-10"></div>
                    </div>
                </div>
            </div>
            <div class="flex-1 bg-slate-100 flex items-center justify-center p-4 md:p-10 relative overflow-hidden">
                <div class="w-[360px] h-[720px] bg-white rounded-[48px] border-[8px] border-slate-900 shadow-2xl overflow-hidden relative z-10 ring-4 ring-slate-900/10">
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-[120px] h-[30px] bg-slate-900 rounded-b-2xl z-30 flex justify-center items-center"><div class="w-16 h-4 bg-slate-800 rounded-full opacity-50"></div></div>
                    <div id="preview-container" class="w-full h-full bg-white overflow-y-auto mesh-gradient text-slate-800 hide-scrollbar pb-20">
                         <div class="pt-16 px-5 text-center flex flex-col items-center">
                            <img id="prev-avatar" class="w-24 h-24 rounded-full border-[3px] border-white/80 shadow-xl object-cover mb-4" src="">
                            <h2 id="prev-name" class="text-xl font-display font-bold text-slate-900 drop-shadow-sm mb-1 px-2"></h2>
                            <p id="prev-bio" class="text-slate-700 text-sm font-medium mb-8 px-4 bg-white/30 backdrop-blur-sm py-2 rounded-xl border border-white/20 inline-block"></p>
                            <div id="prev-links" class="w-full space-y-3"></div>
                         </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PUBLIC VIEW -->
        <div id="view-public" class="view-section hidden flex-grow mesh-gradient min-h-screen">
            <main class="w-full max-w-md mx-auto py-12 px-5 pb-24 min-h-screen flex flex-col items-center">
                <div id="public-content" class="text-center animate-slide-up w-full">
                    <img id="pub-avatar" src="" class="w-28 h-28 rounded-full border-[4px] border-white shadow-2xl relative z-10 mb-5 mx-auto object-cover">
                    <h1 id="pub-name" class="text-2xl font-display font-bold text-slate-900 drop-shadow-sm mb-2"></h1>
                    <p id="pub-bio" class="text-slate-800/90 text-sm font-medium mb-8 bg-white/20 backdrop-blur-md py-2 px-4 rounded-2xl border border-white/30 inline-block"></p>
                    <div id="pub-links" class="space-y-4 w-full"></div>
                </div>
                <div id="public-loader" class="flex justify-center mt-32"><div class="loader w-10 h-10 !border-white/30 !border-t-white"></div></div>
                <div id="public-error" class="hidden text-center text-slate-800 mt-32 bg-white/40 backdrop-blur-xl p-8 rounded-3xl border border-white/50 shadow-xl">
                    <i class="fas fa-ghost text-5xl mb-4 opacity-50"></i><h3 class="text-xl font-bold mb-2">Trang n√†y kh√¥ng t·ªìn t·∫°i</h3>
                    <a href="#" class="inline-block px-6 py-2 bg-slate-900 text-white rounded-xl font-bold text-sm shadow-lg hover:bg-slate-800 transition">T·∫°o Bio mi·ªÖn ph√≠</a>
                </div>
                <footer class="mt-auto pt-10 text-slate-700/60 text-xs font-semibold">Powered by MeowLink</footer>
            </main>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal-create" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-[400px] animate-slide-up relative overflow-hidden">
            <h3 class="text-xl font-display font-bold text-slate-900 mb-6 relative z-10">T·∫°o trang Bio m·ªõi</h3>
            <div class="space-y-4 relative z-10">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Slug</label>
                    <div class="flex items-center border-2 border-slate-200 rounded-xl overflow-hidden bg-slate-50"><span class="bg-slate-100 px-4 py-3 text-slate-500 text-sm font-semibold border-r border-slate-200">/u/</span><input type="text" id="new-slug" placeholder="minhanh" class="flex-1 p-3 outline-none text-sm font-bold text-slate-900 bg-transparent" oninput="this.value = this.value.replace(/[^a-z0-9-_]/g, '').toLowerCase()"></div>
                </div>
            </div>
            <div class="flex gap-3 justify-end mt-8 relative z-10">
                <button onclick="closeCreateModal()" class="px-5 py-2.5 text-slate-600 hover:bg-slate-100 rounded-xl text-sm font-bold">H·ªßy b·ªè</button>
                <button onclick="createNewBio()" class="px-5 py-2.5 bg-brand-600 text-white rounded-xl hover:bg-brand-700 text-sm font-bold shadow-lg">T·∫°o ngay</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAqndpG932fb8RfOUBDAf_Q4R-9llpUJlI", authDomain: "biolink-6e6ee.firebaseapp.com", projectId: "biolink-6e6ee", storageBucket: "biolink-6e6ee.firebasestorage.app", messagingSenderId: "232844523779", appId: "1:232844523779:web:a0bdf6e804892ca5c41136", measurementId: "G-2DSTF8HF5P" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // CAT INTERACTION
        const catContainer = document.getElementById('cat-container');
        const pupilLeft = document.getElementById('pupil-left');
        const pupilRight = document.getElementById('pupil-right');
        const trackInputs = document.querySelectorAll('.track-input');
        const passInputs = document.querySelectorAll('.pass-input');

        // Mouse Tracking
        document.addEventListener('mousemove', (e) => {
            if (catContainer.classList.contains('covering-eyes')) return;
            
            const rect = catContainer.getBoundingClientRect();
            const catCenterX = rect.left + rect.width / 2;
            const catCenterY = rect.top + rect.height / 2;
            
            const dx = (e.clientX - catCenterX) / 25; 
            const dy = (e.clientY - catCenterY) / 25;
            
            const limitX = Math.min(Math.max(dx, -5), 5);
            const limitY = Math.min(Math.max(dy, -5), 5);

            pupilLeft.style.transform = `translate(${limitX}px, ${limitY}px)`;
            pupilRight.style.transform = `translate(${limitX}px, ${limitY}px)`;
        });

        // Email Focus (Like/Happy)
        trackInputs.forEach(input => {
            input.addEventListener('focus', () => catContainer.classList.add('loving-it'));
            input.addEventListener('blur', () => catContainer.classList.remove('loving-it'));
        });

        // Password Focus (Cover Eyes)
        passInputs.forEach(input => {
            input.addEventListener('focus', () => {
                catContainer.classList.add('covering-eyes');
                pupilLeft.style.transform = `translate(0, 0)`; // Reset eyes
                pupilRight.style.transform = `translate(0, 0)`;
            });
            input.addEventListener('blur', () => catContainer.classList.remove('covering-eyes'));
        });

        // APP LOGIC
        let currentUser = null, currentBioData = null, editingSlug = null;

        function handleRoute() {
            const hash = window.location.hash;
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            if (hash.startsWith('#u/')) {
                document.getElementById('view-public').classList.remove('hidden');
                loadPublicBio(hash.split('/')[1]);
            } else if (hash === '#dashboard') {
                if (currentUser) { document.getElementById('view-dashboard').classList.remove('hidden'); loadDashboard(); } 
                else window.location.hash = ''; 
            } else if (hash.startsWith('#edit/')) {
                if (currentUser) { document.getElementById('view-editor').classList.remove('hidden'); loadEditor(hash.split('/')[1]); }
                else window.location.hash = '';
            } else {
                if (currentUser) window.location.hash = '#dashboard';
                else document.getElementById('view-auth').classList.remove('hidden');
            }
        }
        window.addEventListener('hashchange', handleRoute);
        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) { document.getElementById('user-email-display').textContent = user.email; if(!window.location.hash) window.location.hash = '#dashboard'; }
            handleRoute();
        });

        function toggleAuthMode(mode) {
            document.getElementById('form-login').classList.toggle('hidden', mode !== 'login');
            document.getElementById('form-register').classList.toggle('hidden', mode !== 'register');
            document.getElementById('tab-login').classList.toggle('active', mode === 'login');
            document.getElementById('tab-register').classList.toggle('active', mode === 'register');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            document.getElementById('login-loader').classList.remove('hidden');
            try { await auth.signInWithEmailAndPassword(email, pass); showToast("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", "success"); } 
            catch (err) { showToast("L·ªói: " + err.message, "error"); } 
            finally { document.getElementById('login-loader').classList.add('hidden'); }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-password').value;
            document.getElementById('reg-loader').classList.remove('hidden');
            try { await auth.createUserWithEmailAndPassword(email, pass); showToast("ƒêƒÉng k√Ω th√†nh c√¥ng!", "success"); } 
            catch (err) { showToast("L·ªói: " + err.message, "error"); } 
            finally { document.getElementById('reg-loader').classList.add('hidden'); }
        }

        function handleLogout() { auth.signOut(); showToast("ƒê√£ ƒëƒÉng xu·∫•t", "info"); }

        async function loadDashboard() {
            const listEl = document.getElementById('bio-list');
            const loader = document.getElementById('dashboard-loader');
            listEl.innerHTML = ''; loader.classList.remove('hidden');
            try {
                const snapshot = await db.collection('bios').where('ownerId', '==', currentUser.uid).get();
                loader.classList.add('hidden');
                if (snapshot.empty) {
                    listEl.innerHTML = `<div class="col-span-full text-center bg-white p-10 rounded-2xl border-2 border-dashed border-slate-200"><div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300 text-2xl"><i class="fas fa-plus"></i></div><p class="text-slate-500 font-medium">B·∫°n ch∆∞a c√≥ trang Bio n√†o.</p><button onclick="openCreateModal()" class="text-brand-600 font-bold hover:underline mt-2">T·∫°o ngay</button></div>`;
                    return;
                }
                snapshot.forEach(doc => {
                    const data = doc.data();
                    listEl.innerHTML += `<div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-soft hover:shadow-lg transition-all group"><div class="flex items-center gap-4 mb-5"><img src="${data.profile.avatar || 'https://ui-avatars.com/api/?background=random'}" class="w-14 h-14 rounded-full object-cover border shadow-sm"><div class="overflow-hidden"><h3 class="font-bold text-lg text-slate-900 truncate">${data.profile.name}</h3><div class="text-xs text-slate-500 bg-slate-50 px-2 py-0.5 rounded-md w-fit">/${doc.id}</div></div></div><div class="grid grid-cols-3 gap-2 border-t border-slate-50 pt-4"><a href="#edit/${doc.id}" class="col-span-2 bg-slate-900 text-white py-2 rounded-lg text-center text-sm font-bold hover:bg-slate-700 transition">Ch·ªânh s·ª≠a</a><div class="flex gap-2"><button onclick="copyToClipboard('${window.location.origin}${window.location.pathname}#u/${doc.id}')" class="flex-1 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200"><i class="fas fa-copy"></i></button><a href="#u/${doc.id}" target="_blank" class="flex-1 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 flex items-center justify-center"><i class="fas fa-external-link-alt"></i></a></div></div></div>`;
                });
            } catch (err) { showToast("L·ªói: " + err.message, "error"); }
        }

        function openCreateModal() { document.getElementById('modal-create').classList.remove('hidden'); }
        function closeCreateModal() { document.getElementById('modal-create').classList.add('hidden'); }

        async function createNewBio() {
            const slug = document.getElementById('new-slug').value.trim().toLowerCase();
            if (!slug || slug.length < 3) return showToast("Slug ph·∫£i t·ª´ 3 k√Ω t·ª± tr·ªü l√™n", "error");
            try {
                const docRef = db.collection('bios').doc(slug);
                const doc = await docRef.get();
                if (doc.exists) return showToast("Slug n√†y ƒë√£ t·ªìn t·∫°i!", "error");
                await docRef.set({ ownerId: currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp(), profile: { name: "New User", bio: "Welcome to my bio", avatar: "https://ui-avatars.com/api/?name=New+User&background=random" }, links: [{ title: "Facebook", url: "https://facebook.com", highlight: false }] });
                closeCreateModal(); showToast("T·∫°o th√†nh c√¥ng!", "success"); loadDashboard();
            } catch (err) { showToast("L·ªói: " + err.message, "error"); }
        }

        async function loadEditor(slug) {
            editingSlug = slug;
            document.getElementById('editor-url-display').textContent = `${window.location.origin}${window.location.pathname}#u/${slug}`;
            document.getElementById('live-preview-link').href = `#u/${slug}`;
            try {
                const doc = await db.collection('bios').doc(slug).get();
                if (!doc.exists || doc.data().ownerId !== currentUser.uid) return window.location.hash = '#dashboard';
                currentBioData = doc.data();
                document.getElementById('ed-name').value = currentBioData.profile.name;
                document.getElementById('ed-bio').value = currentBioData.profile.bio;
                document.getElementById('ed-avatar').value = currentBioData.profile.avatar;
                renderEditorLinks(); updatePreview();
            } catch (err) { showToast("L·ªói: " + err.message, "error"); }
        }

        function renderEditorLinks() {
            const list = document.getElementById('ed-links-list'); list.innerHTML = '';
            currentBioData.links.forEach((link, idx) => {
                list.innerHTML += `<div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative group"><div class="absolute top-3 right-3 flex gap-2"><label class="cursor-pointer text-xs font-bold text-slate-400 hover:text-brand-600 flex items-center gap-1 bg-slate-50 px-2 py-1 rounded border border-slate-100"><input type="checkbox" class="accent-brand-600" ${link.highlight ? 'checked' : ''} onchange="updateLinkData(${idx}, 'highlight', this.checked)"> N·ªïi b·∫≠t</label><button onclick="removeLink(${idx})" class="text-slate-300 hover:text-red-500 px-1"><i class="fas fa-trash"></i></button></div><div class="space-y-3 pr-20"><div><label class="text-[10px] uppercase font-bold text-slate-400">Ti√™u ƒë·ªÅ</label><input type="text" value="${link.title}" oninput="updateLinkData(${idx}, 'title', this.value)" class="w-full font-bold text-slate-800 outline-none border-b border-dashed border-slate-300 focus:border-brand-500 pb-1 bg-transparent placeholder-slate-300"></div><div><label class="text-[10px] uppercase font-bold text-slate-400">URL</label><div class="flex items-center gap-2"><i class="fas fa-link text-slate-300 text-xs"></i><input type="text" value="${link.url}" oninput="updateLinkData(${idx}, 'url', this.value)" class="w-full text-xs text-blue-600 outline-none bg-transparent placeholder-slate-300 truncate"></div></div></div></div>`;
            });
        }

        function addLinkItem() { currentBioData.links.push({ title: "Link M·ªõi", url: "#", highlight: false }); renderEditorLinks(); updatePreview(); }
        function removeLink(idx) { currentBioData.links.splice(idx, 1); renderEditorLinks(); updatePreview(); }
        function updateLinkData(idx, field, value) { currentBioData.links[idx][field] = value; updatePreview(); }

        function updatePreview() {
            currentBioData.profile.name = document.getElementById('ed-name').value;
            currentBioData.profile.bio = document.getElementById('ed-bio').value;
            currentBioData.profile.avatar = document.getElementById('ed-avatar').value;
            document.getElementById('prev-name').textContent = currentBioData.profile.name;
            document.getElementById('prev-bio').textContent = currentBioData.profile.bio;
            document.getElementById('prev-avatar').src = currentBioData.profile.avatar;
            document.getElementById('prev-avatar').onerror = () => document.getElementById('prev-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentBioData.profile.name)}&background=random`;
            document.getElementById('prev-links').innerHTML = currentBioData.links.map(link => `<a href="#" class="block group relative transform transition-all active:scale-95">${link.highlight ? '<div class="absolute -inset-0.5 bg-gradient-to-r from-pink-500 to-yellow-500 rounded-2xl blur opacity-75 group-hover:opacity-100 transition animate-pulse"></div>' : ''}<div class="relative ${link.highlight ? 'bg-white border-none' : 'glass hover:bg-white/80'} rounded-2xl p-4 flex items-center justify-between shadow-sm border border-white/40"><div class="flex items-center gap-4">${link.highlight ? '<div class="text-orange-500"><i class="fas fa-star"></i></div>' : ''}<span class="font-bold text-sm text-slate-800">${link.title}</span></div><div class="w-8 h-8 rounded-full bg-slate-100/50 flex items-center justify-center text-slate-400 group-hover:bg-brand-600 group-hover:text-white transition-all"><i class="fas fa-arrow-right text-xs"></i></div></div></a>`).join('');
        }

        async function saveCurrentBio() {
            try { await db.collection('bios').doc(editingSlug).update(currentBioData); showToast("ƒê√£ l∆∞u thay ƒë·ªïi!", "success"); } 
            catch (err) { showToast("L·ªói: " + err.message, "error"); }
        }
        function goToDashboard() { window.location.hash = '#dashboard'; }

        async function loadPublicBio(slug) {
            const content = document.getElementById('public-content'), loader = document.getElementById('public-loader'), error = document.getElementById('public-error');
            content.classList.add('hidden'); loader.classList.remove('hidden'); error.classList.add('hidden');
            try {
                const doc = await db.collection('bios').doc(slug).get();
                loader.classList.add('hidden');
                if (!doc.exists) { error.classList.remove('hidden'); return; }
                const data = doc.data();
                content.classList.remove('hidden');
                document.getElementById('pub-name').textContent = data.profile.name;
                document.getElementById('pub-bio').textContent = data.profile.bio;
                document.getElementById('pub-avatar').src = data.profile.avatar;
                document.getElementById('pub-avatar').onerror = () => document.getElementById('pub-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(data.profile.name)}&background=random`;
                document.getElementById('pub-links').innerHTML = data.links.map(link => `<a href="${link.url}" target="_blank" class="block group relative transform transition-all hover:-translate-y-1">${link.highlight ? '<div class="absolute -inset-0.5 bg-gradient-to-r from-rose-400 via-fuchsia-500 to-indigo-500 rounded-2xl blur opacity-75 group-hover:opacity-100 transition"></div>' : ''}<div class="relative ${link.highlight ? 'bg-white' : 'bg-white/70 backdrop-blur-md border border-white/60 hover:bg-white'} rounded-2xl p-4 flex items-center justify-between shadow-lg shadow-slate-900/5"><div class="flex items-center gap-3">${link.highlight ? '<i class="fas fa-fire text-orange-500 animate-pulse"></i>' : ''}<span class="font-bold text-slate-800">${link.title}</span></div><div class="opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 text-brand-600"><i class="fas fa-arrow-right"></i></div></div></a>`).join('');
            } catch (err) { loader.classList.add('hidden'); error.classList.remove('hidden'); }
        }

        function showToast(msg, type='info') {
            const t = document.createElement('div'); t.className = 'toast'; t.innerHTML = `<i class="fas fa-${type==='success'?'check-circle text-green-500':type==='error'?'exclamation-circle text-red-500':'info-circle text-blue-500'} text-xl"></i><span>${msg}</span>`;
            document.getElementById('toast-container').appendChild(t); setTimeout(() => t.remove(), 3000);
        }
        function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => showToast("ƒê√£ copy link!", "success")); }
        document.addEventListener('DOMContentLoaded', handleRoute);
    </script>
</body>
</html>
