<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mewo - Bio Platform</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Inter"', 'sans-serif'], display: ['"Be Vietnam Pro"', 'sans-serif'] },
                    colors: { brand: { 50: '#fff1f2', 100: '#ffe4e6', 500: '#f43f5e', 600: '#e11d48', 700: '#be123c', 900: '#881337' } },
                    animation: { 'fade-in': 'fadeIn 0.4s ease-out', 'slide-up': 'slideUp 0.4s ease-out', 'float': 'float 6s infinite', 'heart-beat': 'heartBeat 1s infinite', 'blob': 'blob 7s infinite' },
                    keyframes: { 
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, 
                        slideUp: { '0%': { transform: 'translateY(15px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }, 
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } }, 
                        heartBeat: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.2)' } },
                        blob: { "0%": { transform: "translate(0px, 0px) scale(1)" }, "33%": { transform: "translate(30px, -50px) scale(1.1)" }, "66%": { transform: "translate(-20px, 20px) scale(0.9)" }, "100%": { transform: "translate(0px, 0px) scale(1)" } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; min-height: 100vh; overflow-x: hidden; }
        
        /* Modern Admin UI Styles */
        .modern-input { width: 100%; padding: 10px 14px; background: #f8fafc; border: 1px solid transparent; border-radius: 12px; font-size: 0.9rem; transition: all 0.2s; outline: none; font-weight: 500; color: #334155; }
        .modern-input:focus { background: #fff; border-color: #cbd5e1; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .modern-input::placeholder { color: #94a3b8; font-weight: 400; }
        
        .modern-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid #f1f5f9; transition: all 0.2s; position: relative; }
        .modern-card:hover { box-shadow: 0 8px 24px -4px rgba(0, 0, 0, 0.08); transform: translateY(-2px); border-color: #e2e8f0; }

        .modern-tab-container { background: #f1f5f9; padding: 4px; border-radius: 14px; display: flex; gap: 4px; width: fit-content; max-width: 100%; overflow-x: auto; }
        .modern-tab { padding: 8px 24px; border-radius: 12px; font-size: 0.9rem; font-weight: 600; color: #64748b; transition: all 0.2s; cursor: pointer; white-space: nowrap; flex-shrink: 0; }
        .modern-tab:hover { color: #334155; }
        .modern-tab.active { background: white; color: #0f172a; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* Landing & Themes */
        .landing-bg { background-color: #fff1f2; color: #1e293b; }
        .perspective-1000 { perspective: 1000px; }
        .rotate-y-12 { transform: rotateY(-12deg) rotateX(5deg); }
        .hero-text-shadow { text-shadow: 0 4px 0 rgba(0,0,0,0.05); }
        .theme-default { background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); animation: meshMove 15s ease infinite; color: white; }
        @keyframes meshMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* Utils */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .hidden { display: none !important; }
        
        /* Cat SVG & Animations */
        .cat-paws { transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); transform-box: fill-box; transform-origin: center top; }
        .cat-heart { opacity: 0; transform: scale(0) translateY(10px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-origin: center; transform-box: fill-box; }
        .loving-it .cat-paws-left { transform: translate(10px, -25px) rotate(30deg); } .loving-it .cat-paws-right { transform: translate(-10px, -25px) rotate(-30deg); } .loving-it .cat-heart { opacity: 1; transform: scale(1.2) translateY(-5px); animation: heartBeat 1s infinite; }
        .covering-eyes .cat-paws-left { transform: translate(12px, -45px) rotate(10deg); } .covering-eyes .cat-paws-right { transform: translate(-12px, -45px) rotate(-10deg); }

        .toast { background: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.15); margin-bottom: 12px; border-left: 4px solid #e11d48; animation: slideInRight 0.4s; display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 0.9rem; position: fixed; top: 24px; right: 24px; z-index: 9999; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="text-slate-800 antialiased selection:bg-brand-100 selection:text-brand-900 font-sans">

    <div id="toast-container"></div>

    <div id="app" class="min-h-screen flex flex-col relative">
        
        <!-- LANDING PAGE -->
        <div id="view-landing" class="view-section hidden flex-grow min-h-screen flex-col bg-[#fff1f2] text-slate-800 overflow-hidden relative">
            <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-[#fecdd3] rounded-full mix-blend-multiply filter blur-[100px] opacity-70 animate-blob"></div>
            <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-[#e9d5ff] rounded-full mix-blend-multiply filter blur-[100px] opacity-70 animate-blob animation-delay-2000"></div>

            <nav class="flex justify-between items-center py-6 px-6 max-w-7xl mx-auto w-full z-10">
                <div class="flex items-center gap-2 text-3xl font-extrabold font-display tracking-tighter text-brand-600"><i class="fas fa-cat"></i> Mewo</div>
                <div class="flex gap-3 items-center">
                    <button onclick="openAuthModal('login')" class="px-5 py-2.5 rounded-xl bg-white/80 hover:bg-white text-slate-800 font-bold transition shadow-sm backdrop-blur-md">ƒêƒÉng nh·∫≠p</button>
                    <button onclick="openAuthModal('register')" class="hidden sm:block px-6 py-2.5 rounded-full bg-brand-600 text-white hover:bg-brand-700 font-extrabold transition shadow-lg shadow-brand-200 transform hover:scale-105">ƒêƒÉng k√Ω ngay</button>
                </div>
            </nav>

            <header class="flex-grow flex flex-col lg:flex-row items-center justify-center px-6 max-w-7xl mx-auto w-full gap-16 py-12 z-10">
                <div class="lg:w-1/2 space-y-8 text-center lg:text-left animate-slide-up">
                    <h1 class="text-6xl lg:text-8xl font-black tracking-tighter leading-[0.95] font-display hero-text-shadow text-slate-900">M·ªçi k·∫øt n·ªëi.<br><span class="text-brand-600">M·ªôt link duy nh·∫•t.</span></h1>
                    <p class="text-xl text-slate-600 max-w-lg font-medium mx-auto lg:mx-0 leading-relaxed">N·ªÅn t·∫£ng Bio Link chuy√™n nghi·ªáp, mi·ªÖn ph√≠ v√† cute nh·∫•t h·ªá m·∫∑t tr·ªùi.</p>
                    <div class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto lg:mx-0">
                        <div class="flex-grow bg-white p-1 pl-5 rounded-2xl flex items-center border-2 border-transparent focus-within:border-brand-200 transition shadow-xl ring-4 ring-slate-50/50">
                            <span class="text-slate-400 font-bold select-none text-lg">mewo.life/</span>
                            <input type="text" id="landing-username" placeholder="username" class="outline-none bg-transparent font-bold w-full ml-1 py-4 text-slate-900 placeholder-slate-300 text-lg lowercase">
                        </div>
                        <button onclick="claimUsername()" class="px-8 py-4 bg-brand-600 hover:bg-brand-700 text-white rounded-2xl font-extrabold text-lg whitespace-nowrap transition shadow-xl shadow-brand-200 transform active:scale-95">B·∫Øt ƒë·∫ßu</button>
                    </div>
                </div>
                <div class="lg:w-1/2 relative justify-center perspective-1000 animate-float hidden md:flex">
                     <div class="w-[340px] h-[680px] bg-slate-900 rounded-[50px] border-[12px] border-slate-900 shadow-2xl overflow-hidden relative rotate-y-12 hover:rotate-0 transition duration-700 ease-out transform-gpu ring-8 ring-white/30">
                        <div class="w-full h-full bg-[#f8fafc] flex flex-col items-center pt-20 px-5 space-y-5 overflow-hidden relative">
                            <div class="absolute top-[-60px] left-[-60px] w-48 h-48 bg-brand-200 rounded-full blur-2xl opacity-60"></div>
                            <img src="https://ui-avatars.com/api/?name=Mewo&background=random&color=fff&size=128" class="w-28 h-28 rounded-full border-4 border-white shadow-xl z-10">
                            <div class="font-extrabold text-slate-900 text-2xl z-10 font-display">@mewo.official</div>
                            <div class="w-full space-y-3 z-10 mt-2">
                                <div class="w-full bg-white p-5 rounded-2xl shadow-sm border border-slate-100 font-bold text-center text-slate-800 transform hover:scale-[1.02] transition cursor-pointer hover:shadow-md">üéµ B√†i h√°t m·ªõi nh·∫•t</div>
                                <div class="w-full bg-white p-5 rounded-2xl shadow-sm border border-slate-100 font-bold text-center text-slate-800 transform hover:scale-[1.02] transition cursor-pointer hover:shadow-md">üõí C·ª≠a h√†ng Merch</div>
                                <div class="w-full bg-white p-5 rounded-2xl shadow-sm border border-slate-100 font-bold text-center text-slate-800 transform hover:scale-[1.02] transition cursor-pointer hover:shadow-md">üì∫ K√™nh YouTube</div>
                            </div>
                        </div>
                     </div>
                </div>
            </header>
        </div>

        <!-- AUTH MODAL -->
        <div id="modal-auth" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl relative animate-slide-up">
                <button onclick="closeModal('modal-auth')" class="absolute top-5 right-5 w-8 h-8 flex items-center justify-center bg-slate-50 text-slate-400 rounded-full hover:bg-slate-100 transition z-10"><i class="fas fa-times"></i></button>
                <div class="p-8 pt-10">
                    <div class="flex justify-center mb-4 h-24 relative" id="cat-container">
                        <svg viewBox="0 0 120 110" class="w-32 h-32">
                            <path d="M30 35 L15 5 Q35 10 45 30 Z" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2" stroke-linejoin="round"/>
                            <path d="M90 35 L105 5 Q85 10 75 30 Z" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2" stroke-linejoin="round"/>
                            <ellipse cx="60" cy="60" rx="45" ry="38" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2.5"/>
                            <ellipse cx="35" cy="70" rx="6" ry="4" fill="#fda4af" opacity="0.6"/>
                            <ellipse cx="85" cy="70" rx="6" ry="4" fill="#fda4af" opacity="0.6"/>
                            <g class="cat-eyes"><circle cx="40" cy="55" r="10" fill="white" stroke="#334155" stroke-width="2"/><circle id="pupil-left" class="cat-pupil" cx="40" cy="55" r="6" fill="#1e293b"/><circle cx="43" cy="52" r="2" fill="white"/><circle cx="80" cy="55" r="10" fill="white" stroke="#334155" stroke-width="2"/><circle id="pupil-right" class="cat-pupil" cx="80" cy="55" r="6" fill="#1e293b"/><circle cx="83" cy="52" r="2" fill="white"/></g>
                            <path d="M57 65 L63 65 L60 68 Z" fill="#fda4af"/>
                            <path d="M60 68 Q50 77 45 70 M60 68 Q70 77 75 70" fill="none" stroke="#334155" stroke-width="1.5" stroke-linecap="round"/>
                            <path class="cat-heart" d="M60 70 C60 60 52 60 52 67 C52 75 60 80 60 80 C60 80 68 75 68 67 C68 60 60 60 60 70" fill="#f43f5e" stroke="#be123c" stroke-width="1"/>
                            <g><ellipse class="cat-paws cat-paws-left" cx="25" cy="95" rx="10" ry="12" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2"/><ellipse class="cat-paws cat-paws-right" cx="95" cy="95" rx="10" ry="12" fill="#f8fafc" stroke="#cbd5e1" stroke-width="2"/></g>
                        </svg>
                    </div>
                    <div class="text-center mb-6"><h2 class="text-2xl font-bold text-slate-900" id="auth-title">Ch√†o m·ª´ng tr·ªü l·∫°i!</h2><p class="text-slate-500 text-sm mt-1">ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c qu·∫£n l√Ω bio.</p></div>
                    <div class="flex bg-slate-100 p-1 rounded-xl mb-6"><button onclick="toggleAuthMode('login')" id="tab-login" class="flex-1 py-2.5 text-sm font-bold rounded-lg shadow-sm bg-white text-slate-900 transition-all">ƒêƒÉng nh·∫≠p</button><button onclick="toggleAuthMode('register')" id="tab-register" class="flex-1 py-2.5 text-sm font-medium text-slate-500 hover:text-slate-700 transition-all">ƒêƒÉng k√Ω</button></div>
                    
                    <form id="form-login" onsubmit="handleLogin(event)" class="space-y-4">
                        <input id="login-email" type="email" placeholder="Email" class="input-modern track-input" required>
                        <input id="login-password" type="password" placeholder="M·∫≠t kh·∫©u" class="input-modern pass-input" required>
                        <button type="submit" class="w-full bg-slate-900 text-white py-3.5 rounded-xl font-bold hover:bg-slate-800 transition flex justify-center items-center gap-2 shadow-lg shadow-slate-200"><span>ƒêƒÉng nh·∫≠p</span><div class="hidden w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" id="login-loader"></div></button>
                    </form>
                    <form id="form-register" onsubmit="handleRegister(event)" class="space-y-4 hidden">
                        <input id="reg-email" type="email" placeholder="Email" class="input-modern track-input" required>
                        <input id="reg-password" type="password" placeholder="M·∫≠t kh·∫©u (min 6 k√Ω t·ª±)" class="input-modern pass-input" minlength="6" required>
                        <button type="submit" class="w-full bg-brand-600 text-white py-3.5 rounded-xl font-bold hover:bg-brand-700 transition flex justify-center items-center gap-2 shadow-lg shadow-brand-200"><span>T·∫°o t√†i kho·∫£n</span><div class="hidden w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" id="reg-loader"></div></button>
                    </form>

                    <div class="relative my-8"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-200"></div></div><div class="relative flex justify-center text-xs uppercase font-bold tracking-wider"><span class="px-2 bg-white text-slate-400">Ho·∫∑c</span></div></div>
                    <button onclick="handleGoogleLogin()" class="w-full flex items-center justify-center gap-3 py-3 border-2 border-slate-100 rounded-xl hover:bg-slate-50 hover:border-slate-300 transition font-bold text-slate-700"><img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> Ti·∫øp t·ª•c v·ªõi Google</button>
                </div>
            </div>
        </div>

        <!-- DASHBOARD VIEW - MODERNIZED -->
        <div id="view-dashboard" class="view-section hidden flex-grow bg-slate-50">
            <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-30">
                <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
                    <div class="flex items-center gap-2 text-brand-600 font-bold text-xl font-display tracking-tight"><i class="fas fa-cat"></i> Mewo</div>
                    <div class="flex items-center gap-4"><span id="user-email-display" class="text-sm font-medium text-slate-600 hidden sm:block"></span><button onclick="handleLogout()" class="text-slate-400 hover:text-red-500 transition"><i class="fas fa-sign-out-alt text-lg"></i></button></div>
                </div>
            </nav>

            <div class="max-w-6xl mx-auto p-6 md:p-10 animate-fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-end mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-900 font-display">Trang Bio C·ªßa B·∫°n</h2>
                        <p class="text-slate-500 mt-1">Qu·∫£n l√Ω v√† theo d√µi hi·ªáu qu·∫£ ho·∫°t ƒë·ªông.</p>
                    </div>
                    <button onclick="openCreateModal()" class="bg-slate-900 text-white px-6 py-3 rounded-2xl hover:bg-slate-800 transition font-bold text-sm shadow-lg hover:shadow-xl transform active:scale-95 flex items-center gap-2"><i class="fas fa-plus"></i> T·∫°o Trang M·ªõi</button>
                </div>
                
                <div id="bio-list" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    <!-- Injected JS Content Here -->
                </div>
                <div id="dashboard-loader" class="flex justify-center mt-20 hidden"><div class="w-10 h-10 border-4 border-slate-200 border-t-brand-600 rounded-full animate-spin"></div></div>
            </div>
        </div>

        <!-- EDITOR VIEW -->
        <div id="view-editor" class="view-section hidden flex-grow bg-slate-100 flex flex-col md:flex-row h-screen overflow-hidden">
            
            <!-- Left Panel (Editor) -->
            <div class="flex-1 flex flex-col h-full z-10 overflow-hidden relative border-r border-slate-200 bg-[#f9fafb]">
                <!-- Header -->
                <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-white sticky top-0 z-30">
                    <button onclick="goToDashboard()" class="text-slate-500 hover:text-slate-900 font-bold text-sm flex items-center gap-2 transition"><i class="fas fa-arrow-left"></i> Dashboard</button>
                    <div class="flex gap-2">
                        <button onclick="toggleMobilePreview()" class="md:hidden w-9 h-9 bg-slate-100 rounded-full flex items-center justify-center"><i class="fas fa-eye"></i></button>
                        <button onclick="saveCurrentBio()" class="bg-slate-900 text-white px-5 py-2 rounded-full font-bold text-sm hover:bg-slate-800 shadow-md flex items-center gap-2 transition hover:scale-105 active:scale-95"><i class="fas fa-save"></i> L∆∞u</button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="px-6 pt-6 pb-2">
                    <div class="bg-slate-200 p-1.5 rounded-2xl flex gap-1 overflow-x-auto hide-scrollbar">
                        <div onclick="switchEditorTab('links')" id="tab-editor-links" class="tab-btn active">Li√™n k·∫øt</div>
                        <div onclick="switchEditorTab('products')" id="tab-editor-products" class="tab-btn">C·ª≠a h√†ng</div>
                        <div onclick="switchEditorTab('appearance')" id="tab-editor-appearance" class="tab-btn">Giao di·ªán</div>
                        <div onclick="switchEditorTab('settings')" id="tab-editor-settings" class="tab-btn">C√†i ƒë·∫∑t</div>
                    </div>
                </div>

                <!-- Scrollable Content -->
                <div class="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6">
                    <!-- URL Info -->
                    <div class="bg-blue-50 border border-blue-100 p-3 rounded-xl flex justify-between items-center">
                        <div class="flex items-center gap-2 overflow-hidden px-1">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse shrink-0"></span>
                            <a id="editor-url-display" href="#" target="_blank" class="text-xs font-bold text-slate-700 hover:text-blue-600 truncate font-mono">...</a>
                        </div>
                        <div class="flex gap-1 shrink-0">
                            <button onclick="copyLink()" class="w-8 h-8 rounded-lg hover:bg-white/50 flex items-center justify-center text-slate-500"><i class="fas fa-copy"></i></button>
                            <button onclick="showQRCode()" class="w-8 h-8 rounded-lg hover:bg-white/50 flex items-center justify-center text-slate-500"><i class="fas fa-qrcode"></i></button>
                        </div>
                    </div>

                    <!-- TAB CONTENT CONTAINERS -->
                    <div id="content-links" class="tab-content space-y-4">
                        <button onclick="addLinkItem()" class="w-full py-4 bg-brand-600 hover:bg-brand-700 text-white rounded-2xl font-bold shadow-lg shadow-brand-500/20 transition flex items-center justify-center gap-2 transform active:scale-95"><i class="fas fa-plus-circle"></i> Th√™m li√™n k·∫øt</button>
                        <div id="links-container" class="space-y-3 mt-4 pb-10"></div>
                    </div>
                    
                    <div id="content-products" class="tab-content hidden space-y-4">
                         <button onclick="addProductItem()" class="w-full py-4 bg-slate-800 hover:bg-slate-900 text-white rounded-2xl font-bold shadow-lg transition flex items-center justify-center gap-2 transform active:scale-95"><i class="fas fa-shopping-bag"></i> Th√™m s·∫£n ph·∫©m</button>
                         <div class="mt-2 text-[10px] text-slate-400 bg-slate-50 p-2 rounded">M·∫πo: T·∫°o Link lo·∫°i "B·ªô s∆∞u t·∫≠p" b√™n tab Li√™n k·∫øt ƒë·ªÉ nh√≥m s·∫£n ph·∫©m.</div>
                         <div id="products-container" class="space-y-3 mt-4 pb-10"></div>
                    </div>

                    <div id="content-appearance" class="tab-content hidden space-y-6">
                        <div class="card-modern space-y-3">
                            <h3 class="text-xs font-bold uppercase text-slate-400">H·ªì s∆°</h3>
                            <div class="flex items-center gap-3">
                                <img id="editor-avatar-img" class="w-12 h-12 rounded-full border bg-slate-100 object-cover">
                                <input id="inp-avatar" oninput="updatePreview()" class="input-modern flex-1" placeholder="Link ·∫£nh avatar...">
                            </div>
                            <input id="inp-name" oninput="updatePreview()" class="input-modern font-bold" placeholder="T√™n hi·ªÉn th·ªã">
                            <textarea id="inp-bio" oninput="updatePreview()" class="input-modern" rows="2" placeholder="Ti·ªÉu s·ª≠..."></textarea>
                        </div>

                        <div class="space-y-2">
                            <h3 class="text-xs font-bold uppercase text-slate-400">Ch·ªß ƒë·ªÅ (Theme)</h3>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setTheme('default')" class="h-16 rounded-lg bg-gradient-to-br from-pink-300 to-rose-400 border-2 border-transparent hover:border-brand-600"></button>
                                <button onclick="setTheme('ocean')" class="h-16 rounded-lg bg-gradient-to-b from-blue-500 to-cyan-400 border-2 border-transparent hover:border-brand-600"></button>
                                <button onclick="setTheme('midnight')" class="h-16 rounded-lg bg-slate-900 border-2 border-transparent hover:border-brand-600"></button>
                                <button onclick="setTheme('forest')" class="h-16 rounded-lg bg-gradient-to-br from-emerald-600 to-teal-400 border-2 border-transparent hover:border-brand-600"></button>
                                <button onclick="setTheme('minimal')" class="h-16 rounded-lg bg-white border border-slate-200 hover:border-brand-600"></button>
                                <button onclick="setTheme('sunset')" class="h-16 rounded-lg bg-gradient-to-tr from-orange-400 to-pink-500 border-2 border-transparent hover:border-brand-600"></button>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <h3 class="text-xs font-bold uppercase text-slate-400">Ki·ªÉu n√∫t</h3>
                            <div class="grid grid-cols-3 gap-2 bg-slate-200 p-1 rounded-xl">
                                <button onclick="setButtonStyle('rounded')" class="py-2 bg-white rounded-lg text-xs font-bold shadow-sm hover:text-brand-600 transition">Tr√≤n</button>
                                <button onclick="setButtonStyle('soft')" class="py-2 bg-slate-200/50 text-slate-600 rounded-lg text-xs font-bold hover:bg-white hover:shadow-sm transition">Bo g√≥c</button>
                                <button onclick="setButtonStyle('rect')" class="py-2 bg-slate-200/50 text-slate-600 rounded-lg text-xs font-bold hover:bg-white hover:shadow-sm transition">Vu√¥ng</button>
                            </div>
                        </div>
                    </div>

                    <div id="content-settings" class="tab-content hidden space-y-4">
                        <div class="card-modern space-y-3">
                            <h3 class="font-bold text-sm text-slate-900">M·∫°ng x√£ h·ªôi</h3>
                            <div id="list-socials" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- RIGHT PANEL: Preview (Fixed Width) -->
            <div class="hidden md:flex w-[480px] bg-white border-l border-slate-200 flex-col items-center justify-center p-6 relative z-20">
                <div class="phone-mockup transform scale-[0.85] xl:scale-100 transition-transform">
                    <div class="dynamic-island"></div>
                    <iframe id="preview-frame" class="w-full h-full bg-white border-none"></iframe>
                </div>
                <div class="mt-6 text-xs font-bold text-slate-300 uppercase tracking-widest">Live Preview</div>
            </div>
        </div>

        <!-- === VIEW: PUBLIC === -->
        <div id="view-public" class="view-section hidden h-full w-full overflow-y-auto"></div>

    </div>

    <!-- MODALS -->
    <!-- Auth Modal -->
    <div id="modal-auth" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl animate-fade-in relative">
            <button onclick="closeModal('modal-auth')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800"><i class="fas fa-times"></i></button>
            <h2 class="text-xl font-bold text-center mb-6" id="auth-title">ƒêƒÉng nh·∫≠p</h2>
            
            <div class="flex bg-slate-100 p-1 rounded-xl mb-6">
                <button onclick="toggleAuthMode('login')" id="tab-login" class="flex-1 py-2 text-sm font-bold rounded-lg shadow-sm bg-white text-slate-900 transition">ƒêƒÉng nh·∫≠p</button>
                <button onclick="toggleAuthMode('register')" id="tab-register" class="flex-1 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 transition">ƒêƒÉng k√Ω</button>
            </div>

            <form id="form-login" onsubmit="handleLogin(event)" class="space-y-3">
                <input id="login-email" type="email" placeholder="Email" class="input-modern" required>
                <input id="login-password" type="password" placeholder="M·∫≠t kh·∫©u" class="input-modern" required>
                <button type="submit" class="btn-primary">ƒêƒÉng nh·∫≠p</button>
                <p class="text-center text-xs text-slate-500 mt-4">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="toggleAuthMode('register')" class="text-brand-600 font-bold">ƒêƒÉng k√Ω</a></p>
            </form>

            <form id="form-register" onsubmit="handleRegister(event)" class="space-y-3 hidden">
                <input id="reg-email" type="email" placeholder="Email" class="input-modern" required>
                <input id="reg-password" type="password" placeholder="M·∫≠t kh·∫©u (min 6)" class="input-modern" minlength="6" required>
                <button type="submit" class="btn-primary">ƒêƒÉng k√Ω</button>
                <p class="text-center text-xs text-slate-500 mt-4">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="toggleAuthMode('login')" class="text-brand-600 font-bold">ƒêƒÉng nh·∫≠p</a></p>
            </form>
            
            <div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t"></div></div><div class="relative flex justify-center text-xs text-slate-400 bg-white px-2">HO·∫∂C</div></div>
            <button onclick="handleGoogleLogin()" class="w-full py-2.5 border rounded-xl flex items-center justify-center gap-2 hover:bg-slate-50 font-bold text-sm text-slate-700 transition"><img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> Google</button>
        </div>
    </div>

    <!-- Create Modal -->
    <div id="modal-create" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 animate-fade-in">
            <h3 class="font-bold text-lg mb-4">T·∫°o Mewo m·ªõi</h3>
            <div class="flex bg-slate-50 border rounded-lg overflow-hidden mb-4 items-center">
                <span class="pl-3 pr-1 text-slate-400 text-sm font-bold">mewo.life/</span>
                <input id="create-slug" placeholder="username" class="flex-1 p-3 bg-transparent outline-none font-bold text-sm lowercase text-slate-800">
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('modal-create')" class="px-4 py-2 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded-lg">H·ªßy</button>
                <button onclick="createNewBio()" class="px-4 py-2 bg-brand-600 text-white text-sm font-bold rounded-lg hover:bg-brand-700" id="btn-create-action">T·∫°o ngay</button>
            </div>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="modal-qr" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-4" onclick="closeModal('modal-qr')">
        <div class="bg-white p-6 rounded-2xl text-center" onclick="event.stopPropagation()">
            <h3 class="font-bold mb-4">M√£ QR c·ªßa b·∫°n</h3>
            <img id="qr-img" class="w-48 h-48 mx-auto border rounded-lg mb-4">
            <button onclick="closeModal('modal-qr')" class="w-full py-2 bg-slate-100 font-bold rounded-lg">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Mobile Preview Modal -->
    <div id="modal-mobile-preview" class="fixed inset-0 bg-black/90 z-[70] hidden flex flex-col items-center justify-center p-4">
        <button onclick="toggleMobilePreview()" class="absolute top-4 right-4 w-10 h-10 bg-white/20 rounded-full text-white"><i class="fas fa-times"></i></button>
        <div class="w-full h-full max-w-[340px] max-h-[650px] bg-white rounded-[30px] overflow-hidden">
            <iframe id="mobile-preview-frame" class="w-full h-full bg-white border-none"></iframe>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAqndpG932fb8RfOUBDAf_Q4R-9llpUJlI", authDomain: "biolink-6e6ee.firebaseapp.com", projectId: "biolink-6e6ee", storageBucket: "biolink-6e6ee.firebasestorage.app", messagingSenderId: "232844523779", appId: "1:232844523779:web:a0bdf6e804892ca5c41136", measurementId: "G-2DSTF8HF5P" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        window.onerror = function(m) { console.error(m); showToast("L·ªói: "+m, "error"); };

        let currentUser = null, currentBioData = null, editingSlug = null;
        const socialPlatforms = ['facebook','instagram','tiktok','youtube','twitter','email'];

        // --- ROUTING & AUTH ---
        function handleRoute() {
            if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', handleRoute); return; }
            const hash = window.location.hash;
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            
            // Hide Modals on route change (except when needed)
            if(hash !== '' && hash !== '#') closeModal('modal-auth');

            if (hash.startsWith('#u/')) {
                // Public View
                document.getElementById('view-public').classList.remove('hidden');
                loadPublicBio(hash.split('/')[1]);
            } else if (hash === '#dashboard') {
                if (currentUser) {
                    document.getElementById('view-dashboard').classList.remove('hidden');
                    loadDashboard();
                } else {
                    window.location.hash = ''; // Redirect to landing
                }
            } else if (hash.startsWith('#edit/')) {
                if (currentUser) {
                    document.getElementById('view-editor').classList.remove('hidden');
                    loadEditor(hash.split('/')[1]);
                } else {
                    window.location.hash = '';
                }
            } else {
                // Landing Page
                if (currentUser) window.location.hash = '#dashboard';
                else document.getElementById('view-landing').classList.remove('hidden');
            }
        }
        window.addEventListener('hashchange', handleRoute);
        window.addEventListener('load', handleRoute);

        // --- AUTH ---
        auth.onAuthStateChanged(async user => {
            currentUser = user;
            if (user) {
                const emailEl = document.getElementById('user-email-display');
                if(emailEl) emailEl.textContent = user.email || 'User';
                if (!window.location.hash || window.location.hash === '#') window.location.hash = '#dashboard';
                else if (window.location.hash === '#dashboard') loadDashboard(); // Reload if already on dashboard
            } else {
                if (window.location.hash === '#dashboard' || window.location.hash.startsWith('#edit/')) window.location.hash = '';
            }
        });

        function openAuthModal(mode) {
            document.getElementById('modal-auth').classList.remove('hidden');
            toggleAuthMode(mode);
        }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function claimUsername() { openAuthModal('register'); setTimeout(()=>document.getElementById('reg-email').focus(), 100); }
        function toggleAuthMode(mode) {
            document.getElementById('form-login').classList.toggle('hidden', mode !== 'login');
            document.getElementById('form-register').classList.toggle('hidden', mode !== 'register');
            document.getElementById('auth-title').innerText = mode === 'login' ? 'ƒêƒÉng nh·∫≠p' : 'T·∫°o t√†i kho·∫£n';
            document.getElementById('tab-login').classList.toggle('active', mode === 'login');
            document.getElementById('tab-register').classList.toggle('active', mode === 'register');
        }

        async function handleLogin(e) { e.preventDefault(); authAction(auth.signInWithEmailAndPassword, 'login'); }
        async function handleRegister(e) { e.preventDefault(); authAction(auth.createUserWithEmailAndPassword, 'register'); }
        async function authAction(method, type) {
            const email = document.getElementById(type==='login'?'login-email':'reg-email').value;
            const pass = document.getElementById(type==='login'?'login-password':'reg-password').value;
            try { await method(email, pass); closeModal('modal-auth'); showToast("Th√†nh c√¥ng!", "success"); } 
            catch(err) { showToast("L·ªói: "+err.message, "error"); }
        }
        async function handleGoogleLogin() { try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); closeModal('modal-auth'); } catch(e){ showToast(e.message, 'error'); } }
        function handleLogout() { auth.signOut(); showToast("ƒê√£ ƒëƒÉng xu·∫•t"); }

        // --- DASHBOARD ---
        async function loadDashboard() {
            const list = document.getElementById('bio-list');
            list.innerHTML = ''; 
            document.getElementById('dashboard-loader').classList.remove('hidden');

            try {
                const snap = await db.collection('bios').where('ownerId','==',currentUser.uid).get();
                let html = '';
                if(snap.empty) {
                     html = `<div class="col-span-full text-center py-20 opacity-50"><i class="fas fa-ghost text-4xl mb-2"></i><p>Ch∆∞a c√≥ trang n√†o</p></div>`;
                } else {
                    snap.forEach(d => {
                        const data = d.data();
                        html += `
                        <div class="card-modern cursor-pointer hover:border-brand-500 group" onclick="location.hash='#edit/${d.id}'">
                            <div class="flex items-center gap-4 mb-4">
                                <img src="${data.profile.avatar || 'https://ui-avatars.com/api/?background=random'}" class="w-14 h-14 rounded-full border bg-slate-100 object-cover">
                                <div>
                                    <h3 class="font-bold text-lg text-slate-800 truncate max-w-[150px]">${data.profile.name}</h3>
                                    <div class="text-xs text-slate-400 font-mono">/${d.id}</div>
                                </div>
                            </div>
                            <div class="flex justify-between border-t pt-3 mt-2">
                                <div class="text-xs font-bold text-slate-400 uppercase">Views: <span class="text-slate-800 text-sm">${data.views||0}</span></div>
                                <div class="text-brand-600 font-bold text-xs group-hover:underline">Ch·ªânh s·ª≠a &rarr;</div>
                            </div>
                        </div>`;
                    });
                }
                list.innerHTML = html;
            } catch(e) { showToast(e.message, 'error'); } 
            finally { document.getElementById('dashboard-loader').classList.add('hidden'); }
        }

        function openCreateModal() { document.getElementById('modal-create').classList.remove('hidden'); }
        async function createNewBio() {
            const btn = document.getElementById('btn-create-action');
            if(btn.disabled) return;
            const slug = document.getElementById('create-slug').value.trim().toLowerCase();
            if(slug.length < 3) return showToast("T√™n qu√° ng·∫Øn", "error");
            btn.disabled = true; btn.innerText = "...";
            
            try {
                const ref = db.collection('bios').doc(slug);
                if((await ref.get()).exists) return showToast("T√™n ƒë√£ t·ªìn t·∫°i", "error");
                
                await ref.set({
                    ownerId: currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    profile: { name: "New User", bio: "Welcome", avatar: `https://ui-avatars.com/api/?name=${slug}&background=random` },
                    links: [], products: [], theme: { id: 'default', buttonStyle: 'rounded' }, socials: {}, views: 0
                });
                
                closeModal('modal-create');
                loadDashboard();
                showToast("T·∫°o th√†nh c√¥ng!", "success");
            } catch(e) { showToast(e.message, 'error'); }
            finally { btn.disabled = false; btn.innerText = "T·∫°o ngay"; }
        }

        // --- EDITOR ---
        async function loadEditor(slug) {
            editingSlug = slug;
            document.getElementById('editor-url-display').innerText = `mewo.life/${slug}`;
            document.getElementById('editor-url-display').href = `#u/${slug}`;
            
            const doc = await db.collection('bios').doc(slug).get();
            if(!doc.exists) { window.location.hash = '#dashboard'; return; }
            
            currentBioData = doc.data();
            currentBioData.links = currentBioData.links || [];
            currentBioData.products = currentBioData.products || [];
            currentBioData.socials = currentBioData.socials || {};
            currentBioData.theme = currentBioData.theme || {id:'default'};

            // Bind Data
            document.getElementById('inp-name').value = currentBioData.profile.name;
            document.getElementById('inp-bio').value = currentBioData.profile.bio;
            document.getElementById('inp-avatar').value = currentBioData.profile.avatar;
            document.getElementById('editor-avatar-img').src = currentBioData.profile.avatar; // FIXED ID

            renderEditorLinks();
            renderEditorProducts();
            renderSocials();
            switchTab('links');
            updatePreview();
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.add('hidden'));
            document.getElementById(`content-${t}`).classList.remove('hidden');
            ['links','products','appearance','settings'].forEach(k => {
                const btn = document.getElementById(`tab-${k}`);
                if(btn) btn.className = k===t ? 'tab-btn active' : 'tab-btn';
            });
        }

        // Render Functions (Clean & Robust)
        const esc = (t) => t ? t.replace(/"/g, '&quot;') : '';

        function renderEditorLinks() {
            const c = document.getElementById('links-container'); c.innerHTML='';
            currentBioData.links.forEach((l, i) => {
                c.innerHTML += `
                <div class="card-modern group">
                    <div class="absolute top-3 right-3 flex gap-2">
                        <select onchange="upLink(${i},'type',this.value)" class="text-xs border border-slate-200 rounded-lg p-1 bg-slate-50 outline-none"><option value="link" ${l.type!=='collection'?'selected':''}>Link</option><option value="collection" ${l.type==='collection'?'selected':''}>B·ªô s∆∞u t·∫≠p</option></select>
                        <button onclick="rmLink(${i})" class="text-slate-300 hover:text-red-500"><i class="fas fa-trash"></i></button>
                    </div>
                    <input value="${esc(l.title)}" oninput="upLink(${i},'title',this.value)" class="font-bold w-full outline-none mb-2" placeholder="Ti√™u ƒë·ªÅ">
                    <input value="${esc(l.url)}" oninput="upLink(${i},'url',this.value)" class="text-xs w-full text-slate-500 outline-none" placeholder="https://...">
                </div>`;
            });
        }

        function renderEditorProducts() {
            const c = document.getElementById('products-container'); c.innerHTML='';
            const cols = currentBioData.links.filter(l=>l.type==='collection').map(l=>`<option value="${l.title}">${l.title}</option>`).join('');
            currentBioData.products.forEach((p, i) => {
                c.innerHTML += `
                <div class="card-modern flex gap-3">
                    <img src="${p.image||'https://placehold.co/100'}" class="w-16 h-16 rounded bg-slate-100 object-cover">
                    <div class="flex-1 space-y-1">
                        <input value="${esc(p.name)}" oninput="upProd(${i},'name',this.value)" class="font-bold w-full text-sm outline-none" placeholder="T√™n SP">
                        <div class="flex gap-2">
                             <input value="${esc(p.price)}" oninput="upProd(${i},'price',this.value)" class="w-16 text-xs font-bold text-brand-600 outline-none bg-slate-50 px-1 rounded" placeholder="Gi√°">
                             <select onchange="upProd(${i},'collection',this.value)" class="text-xs border rounded w-full">${cols}<option value="" ${!p.collection?'selected':''}>Ch·ªçn BST...</option></select>
                        </div>
                        <input value="${esc(p.image)}" oninput="upProd(${i},'image',this.value)" class="text-[10px] w-full border-b" placeholder="Link ·∫£nh">
                        <input value="${esc(p.link)}" oninput="upProd(${i},'link',this.value)" class="text-[10px] w-full border-b" placeholder="Link mua">
                    </div>
                    <button onclick="rmProd(${i})" class="text-slate-300 hover:text-red-500 self-start"><i class="fas fa-trash"></i></button>
                </div>`;
            });
        }
        
        function renderSocials() {
            const c = document.getElementById('list-socials'); c.innerHTML='';
            socialPlatforms.forEach(p => {
                c.innerHTML += `<div class="flex items-center gap-3 p-2 bg-slate-50 rounded-lg border border-slate-100"><i class="fab fa-${p==='email'?'google':p} text-slate-400 w-5 text-center"></i><input value="${currentBioData.socials[p]||''}" oninput="upSocial('${p}',this.value)" class="bg-transparent text-sm w-full outline-none" placeholder="${p} url..."></div>`
            });
        }

        // Data Update Helpers
        function addLinkItem() { currentBioData.links.push({title:'Link m·ªõi', url:'#', type:'link'}); renderEditorLinks(); updatePreview(); }
        function rmLink(i) { currentBioData.links.splice(i,1); renderEditorLinks(); updatePreview(); }
        function upLink(i,k,v) { currentBioData.links[i][k]=v; updatePreview(); }
        
        function addProductItem() { currentBioData.products.push({name:'S·∫£n ph·∫©m', price:'0ƒë', image:'', link:'#', collection:''}); renderEditorProducts(); updatePreview(); }
        function rmProd(i) { currentBioData.products.splice(i,1); renderEditorProducts(); updatePreview(); }
        function upProd(i,k,v) { currentBioData.products[i][k]=v; updatePreview(); }
        
        function upSocial(k,v) { currentBioData.socials[k]=v; updatePreview(); }
        function setTheme(id) { currentBioData.theme.id=id; updatePreview(); }
        function setButtonStyle(s) { if(!currentBioData.theme) currentBioData.theme={}; currentBioData.theme.buttonStyle=s; updatePreview(); }
        function goToDashboard() { window.location.hash = '#dashboard'; }

        function updatePreview() {
            // Update Profile State
            currentBioData.profile.name = document.getElementById('inp-name').value;
            currentBioData.profile.bio = document.getElementById('inp-bio').value;
            currentBioData.profile.avatar = document.getElementById('inp-avatar').value;
            document.getElementById('editor-avatar-img').src = currentBioData.profile.avatar; // FIXED ID

            // Render Iframe
            const html = generatePublicHTML(currentBioData, true);
            const frames = [document.getElementById('preview-frame'), document.getElementById('mobile-preview-frame')];
            frames.forEach(f => {
                if(f) { const doc = f.contentDocument || f.contentWindow.document; doc.open(); doc.write(html); doc.close(); }
            });
        }
        
        async function saveCurrentBio() {
            try { await db.collection('bios').doc(editingSlug).update(currentBioData); showToast("ƒê√£ l∆∞u!", "success"); } catch(e){ showToast(e.message, 'error'); }
        }
        
        function toggleMobilePreview() { const m=document.getElementById('modal-mobile-preview'); m.classList.toggle('hidden'); if(!m.classList.contains('hidden')) updatePreview(); }
        function showQRCode() { document.getElementById('modal-qr').classList.remove('hidden'); document.getElementById('qr-img').src=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(window.location.origin+'/#u/'+editingSlug)}`; }
        
        // --- PUBLIC VIEW & RENDERER ---
        async function loadPublicBio(slug) {
            const container = document.getElementById('view-public');
            try {
                const doc = await db.collection('bios').doc(slug).get();
                if(!doc.exists) { container.innerHTML = '<div class="h-screen flex items-center justify-center">Trang kh√¥ng t·ªìn t·∫°i</div>'; return; }
                window.publicProducts = doc.data().products || []; // Global for shop
                container.innerHTML = generatePublicHTML(doc.data(), false);
                
                // Analytics
                db.collection('bios').doc(slug).update({ views: firebase.firestore.FieldValue.increment(1) });
            } catch(e) { container.innerHTML = 'L·ªói: '+e.message; }
        }

        function generatePublicHTML(data, isPreview) {
            const theme = data.theme || {id:'default', buttonStyle:'rounded'};
            const radius = theme.buttonStyle==='rect'?'rounded-md':theme.buttonStyle==='soft'?'rounded-2xl':'rounded-full';
            const safeProducts = JSON.stringify(data.products || []).replace(/\\/g, '\\\\').replace(/"/g, '\\"');
            
            // Logic for Scripts (Shop & Collections)
            const script = `
            <script>
                const products = JSON.parse("${safeProducts}");
                function showShop(col) {
                    document.getElementById('main-view').style.display='none';
                    document.getElementById('shop-view').style.display='block';
                    document.getElementById('shop-title').innerText = col;
                    const grid = document.getElementById('prod-grid');
                    grid.innerHTML = products.filter(p=>p.collection===col).map(p=>\`<div class="bg-white rounded-lg overflow-hidden shadow-sm"><img src="\${p.image}" class="w-full h-32 object-cover bg-slate-100"><div class="p-2"><div class="font-bold text-xs truncate text-slate-800">\${p.name}</div><div class="flex justify-between items-center mt-1"><span class="text-xs font-bold text-red-500">\${p.price}</span><a href="\${p.link}" target="_blank" class="bg-black text-white text-[10px] px-2 py-1 rounded">Mua</a></div></div></div>\`).join('');
                    if(!grid.innerHTML) grid.innerHTML='<div class="col-span-2 text-center text-white opacity-50 py-10">Tr·ªëng</div>';
                }
                function closeShop() {
                    document.getElementById('shop-view').style.display='none';
                    document.getElementById('main-view').style.display='block';
                }
            <\/script>`;

            // Generate Links HTML
            const links = (data.links||[]).map(l => {
                const safeTitle = l.title.replace(/"/g, '&quot;').replace(/'/g, "\\'");
                if(l.type === 'collection') {
                    const act = isPreview ? `showShop('${safeTitle}')` : `window.showShop('${safeTitle}')`;
                    return `<div onclick="${act}" class="cursor-pointer mb-3 p-4 bg-white/90 backdrop-blur rounded-full shadow-sm flex justify-between items-center hover:bg-white transition"><span class="font-bold text-sm pl-2 border-l-4 border-brand-500">${l.title}</span><i class="fas fa-chevron-right text-gray-400"></i></div>`;
                }
                return `<a href="${l.url}" target="_blank" class="block mb-3 p-4 bg-white/90 backdrop-blur rounded-full shadow-sm text-center font-bold text-sm hover:bg-white transition hover:-translate-y-1">${l.title}</a>`;
            }).join('');
            
            const socials = Object.entries(data.socials||{}).map(([k,v]) => v ? `<a href="${v}" target="_blank" class="text-2xl text-white/90 hover:text-white transition"><i class="fab fa-${k==='email'?'google':k}"></i></a>` : '').join('');

            const css = `
                body{margin:0;font-family:sans-serif} ::-webkit-scrollbar{width:0}
                .theme-default{background:linear-gradient(45deg, #ff9a9e, #fad0c4)}
                .theme-ocean{background:linear-gradient(to bottom, #2193b0, #6dd5ed)}
                .theme-midnight{background:#111;color:#fff}
                .theme-forest{background:linear-gradient(to right, #11998e, #38ef7d)}
                .theme-minimal{background:#f3f4f6;color:#333}
                .theme-sunset{background:linear-gradient(to top, #fbc2eb 0%, #a6c1ee 100%)}
                .wrapper{min-height:100vh;padding:40px 20px;display:flex;flex-direction:column;align-items:center}
            `;

            const content = `
                <div class="wrapper theme-${theme.id}">
                    <div id="main-view" class="w-full max-w-md text-center">
                        <img src="${data.profile.avatar}" class="w-24 h-24 rounded-full border-4 border-white/30 shadow-xl mx-auto mb-4 object-cover" onerror="this.src='https://ui-avatars.com/api/?name=User'">
                        <h1 class="text-xl font-bold mb-1 text-white drop-shadow-md">${data.profile.name}</h1>
                        <p class="text-sm text-white/80 mb-6 font-medium whitespace-pre-line">${data.profile.bio}</p>
                        <div class="flex justify-center gap-4 mb-8">${socials}</div>
                        <div class="w-full text-left">${links}</div>
                    </div>

                    <div id="shop-view" class="w-full max-w-md hidden" style="display:none">
                        <div class="flex items-center gap-3 mb-4 text-white">
                            <button onclick="${isPreview?'closeShop()':'window.closeShop()'}" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                            <h2 class="font-bold text-lg" id="shop-title">Shop</h2>
                        </div>
                        <div id="prod-grid" class="grid grid-cols-2 gap-3"></div>
                    </div>
                    
                    ${!isPreview ? '<footer class="mt-auto pt-10 text-xs text-white/50">Powered by Mewo</footer>' : ''}
                </div>
                ${script}
            `;

            if(isPreview) return `<!DOCTYPE html><html><head><script src="https://cdn.tailwindcss.com"><\/script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><style>${css}</style></head><body>${content}</body></html>`;
            return `<style>${css}</style>${content}`;
        }
        
        // --- GLOBAL HELPERS (SPA MODE) ---
        window.showShop = function(col) {
            document.getElementById('main-view').style.display='none';
            document.getElementById('shop-view').style.display='block';
            document.getElementById('shop-title').innerText = col;
            const grid = document.getElementById('prod-grid');
            grid.innerHTML = window.publicProducts.filter(p => p.collection === col).map(p => `
                <div class="bg-white rounded-lg overflow-hidden shadow-sm">
                    <img src="${p.image}" class="w-full h-32 object-cover bg-slate-100">
                    <div class="p-2">
                        <div class="font-bold text-xs truncate text-slate-800">${p.name}</div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-xs font-bold text-red-500">${p.price}</span>
                            <a href="${p.link}" target="_blank" class="bg-black text-white text-[10px] px-2 py-1 rounded">Mua</a>
                        </div>
                    </div>
                </div>
            `).join('');
            if(!grid.innerHTML) grid.innerHTML='<div class="col-span-2 text-center text-white opacity-50 py-10">Tr·ªëng</div>';
        };
        window.closeShop = function() {
            document.getElementById('shop-view').style.display='none';
            document.getElementById('main-view').style.display='block';
        };

        function showToast(m,t='info'){ const d=document.createElement('div');d.className='toast';d.innerText=m;document.getElementById('toast-container').appendChild(d);setTimeout(()=>d.remove(),3000); }
        function copyToClipboard(t){ navigator.clipboard.writeText(t).then(()=>showToast("ƒê√£ sao ch√©p","success")); }
    </script>
</body>
</html>
