import React, { useState, useEffect } from 'react';
import { 
  Plus, 
  Trash2, 
  Layout, 
  User, 
  Palette, 
  Share2, 
  Cat, 
  GripVertical, 
  Eye,
  Instagram,
  Facebook,
  Twitter,
  Globe,
  Smartphone,
  Check
} from 'lucide-react';

// --- 1. C√ÅC COMPONENT PH·ª§ TR·ª¢ (UI ELEMENTS) ---

// N√∫t chuy·ªÉn ƒë·ªïi (Toggle Switch)
const Toggle = ({ checked, onChange }) => (
  <button 
    onClick={() => onChange(!checked)}
    className={`w-11 h-6 flex items-center rounded-full p-1 transition-colors duration-300 ${checked ? 'bg-orange-500' : 'bg-gray-300'}`}
  >
    <div className={`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-300 ${checked ? 'translate-x-5' : ''}`} />
  </button>
);

// --- 2. ·ª®NG D·ª§NG CH√çNH (MAIN APP) ---

export default function App() {
  // --- STATE (D·ªÆ LI·ªÜU) ---
  const [activeTab, setActiveTab] = useState('links'); // 'links', 'appearance', 'settings'
  const [mobilePreviewMode, setMobilePreviewMode] = useState(false); // Ch·∫ø ƒë·ªô xem tr∆∞·ªõc tr√™n mobile

  // D·ªØ li·ªáu Profile
  const [profile, setProfile] = useState({
    username: 'mewo_user',
    displayName: 'Ho√†ng Th∆∞·ª£ng M√®o',
    bio: 'Chuy√™n gia b·∫Øt chu·ªôt & Marketing üêü | CEO @Mewo',
    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix',
  });

  // D·ªØ li·ªáu Giao di·ªán (Theme)
  const [theme, setTheme] = useState({
    background: 'bg-slate-50', // Tailwind class
    buttonStyle: 'rounded-xl', // rounded-none, rounded-xl, rounded-full
    buttonColor: 'bg-white',
    textColor: 'text-slate-800',
    accentColor: 'text-orange-500',
  });

  // Danh s√°ch Links
  const [links, setLinks] = useState([
    { id: 1, title: 'Gh√© thƒÉm Mewo Website', url: 'https://mewo.vn', active: true, icon: 'shop' },
    { id: 2, title: 'ƒê·∫∑t l·ªãch t∆∞ v·∫•n (Book me)', url: 'https://cal.com', active: true, icon: 'calendar' },
    { id: 3, title: 'Nh·∫≠n Ebook Mi·ªÖn Ph√≠', url: 'https://gumroad.com', active: false, icon: 'book' },
  ]);

  // --- C√ÅC H√ÄM X·ª¨ L√ù (ACTIONS) ---

  const handleAddLink = () => {
    const newLink = {
      id: Date.now(),
      title: '',
      url: '',
      active: true,
      icon: 'link'
    };
    setLinks([newLink, ...links]);
  };

  const handleUpdateLink = (id, field, value) => {
    setLinks(links.map(link => link.id === id ? { ...link, [field]: value } : link));
  };

  const handleDeleteLink = (id) => {
    setLinks(links.filter(link => link.id !== id));
  };

  const handleToggleLink = (id) => {
    setLinks(links.map(link => link.id === id ? { ...link, active: !link.active } : link));
  };

  // --- 3. PH·∫¶N HI·ªÇN TH·ªä (VIEW) ---

  return (
    <div className="flex h-screen bg-gray-100 font-sans overflow-hidden">
      
      {/* --- SIDEBAR MENU (DESKTOP) --- */}
      <aside className="w-16 md:w-64 bg-white border-r border-gray-200 flex flex-col justify-between z-20">
        <div>
          <div className="h-16 flex items-center justify-center md:justify-start md:px-6 border-b border-gray-100">
            {/* Minimalist Logo Update: Icon outline & Lowercase text */}
            <div className="flex items-center gap-2 text-slate-900 group cursor-pointer">
              <Cat size={28} strokeWidth={1.5} className="group-hover:text-orange-500 transition-colors" />
              <span className="hidden md:block font-bold text-2xl tracking-tight lowercase group-hover:text-orange-500 transition-colors">mewo</span>
            </div>
          </div>

          <nav className="mt-6 flex flex-col space-y-2 px-2">
            <NavItem 
              icon={<Layout size={20} />} 
              label="Li√™n k·∫øt" 
              active={activeTab === 'links'} 
              onClick={() => setActiveTab('links')} 
            />
            <NavItem 
              icon={<Palette size={20} />} 
              label="Giao di·ªán" 
              active={activeTab === 'appearance'} 
              onClick={() => setActiveTab('appearance')} 
            />
            <NavItem 
              icon={<User size={20} />} 
              label="T√†i kho·∫£n" 
              active={activeTab === 'settings'} 
              onClick={() => setActiveTab('settings')} 
            />
          </nav>
        </div>

        <div className="p-4 border-t border-gray-100 hidden md:block">
          <button className="flex items-center space-x-2 text-sm text-gray-500 hover:text-orange-500 transition-colors">
            <Share2 size={16} />
            <span>Chia s·∫ª Mewo c·ªßa b·∫°n</span>
          </button>
        </div>
      </aside>

      {/* --- MAIN EDITOR AREA --- */}
      <main className="flex-1 flex flex-col h-full overflow-hidden relative">
        
        {/* Header Mobile */}
        <header className="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 md:px-8">
          <h2 className="text-lg font-bold text-gray-800">
            {activeTab === 'links' && 'Qu·∫£n l√Ω Li√™n k·∫øt'}
            {activeTab === 'appearance' && 'T√πy ch·ªânh Giao di·ªán'}
            {activeTab === 'settings' && 'C√†i ƒë·∫∑t T√†i kho·∫£n'}
          </h2>
          
          <button 
            className="md:hidden p-2 text-gray-600 bg-gray-100 rounded-lg"
            onClick={() => setMobilePreviewMode(!mobilePreviewMode)}
          >
            {mobilePreviewMode ? <Layout size={20}/> : <Eye size={20}/>}
          </button>

          <div className="hidden md:flex items-center space-x-2 text-sm">
            <span className="text-gray-500">Link c·ªßa b·∫°n:</span>
            <a href="#" className="text-orange-500 font-medium hover:underline">mewo.me/{profile.username}</a>
          </div>
        </header>

        {/* Scrollable Content */}
        <div className="flex-1 overflow-y-auto p-4 md:p-8 pb-32 md:pb-8">
          <div className="max-w-2xl mx-auto">
            
            {/* TAB: LINKS */}
            {activeTab === 'links' && (
              <div className="space-y-6">
                {/* Profile Quick Edit */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-6 items-center md:items-start">
                   <div className="relative group cursor-pointer">
                      <img src={profile.avatar} alt="Avatar" className="w-20 h-20 rounded-full object-cover border-2 border-gray-200" />
                      <div className="absolute inset-0 bg-black/30 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs">
                        ƒê·ªïi ·∫£nh
                      </div>
                   </div>
                   <div className="flex-1 w-full space-y-3">
                      <input 
                        type="text" 
                        value={profile.displayName}
                        onChange={(e) => setProfile({...profile, displayName: e.target.value})}
                        className="w-full text-lg font-bold border-none p-0 focus:ring-0 placeholder-gray-400"
                        placeholder="T√™n hi·ªÉn th·ªã"
                      />
                      <textarea 
                        value={profile.bio}
                        onChange={(e) => setProfile({...profile, bio: e.target.value})}
                        className="w-full text-sm text-gray-600 border-none p-0 focus:ring-0 resize-none h-14 bg-transparent placeholder-gray-400"
                        placeholder="Vi·∫øt bio ng·∫Øn g·ªçn..."
                      />
                   </div>
                </div>

                {/* Add Link Button */}
                <button 
                  onClick={handleAddLink}
                  className="w-full py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-full font-bold shadow-md shadow-orange-200 transition-all flex items-center justify-center space-x-2 transform active:scale-95"
                >
                  <Plus size={20} />
                  <span>Th√™m li√™n k·∫øt m·ªõi</span>
                </button>

                {/* Links List */}
                <div className="space-y-4">
                  {links.length === 0 && (
                    <div className="text-center py-10 text-gray-400">
                      Ch∆∞a c√≥ li√™n k·∫øt n√†o. H√£y th√™m c√°i ƒë·∫ßu ti√™n! üêæ
                    </div>
                  )}
                  {links.map((link, index) => (
                    <div key={link.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-200 group hover:border-orange-300 transition-colors">
                      <div className="flex items-start gap-3">
                        <div className="mt-3 cursor-grab text-gray-300 hover:text-gray-500">
                          <GripVertical size={20} />
                        </div>
                        <div className="flex-1 space-y-2">
                          <div className="flex items-center justify-between">
                             <input 
                                type="text" 
                                value={link.title}
                                onChange={(e) => handleUpdateLink(link.id, 'title', e.target.value)}
                                placeholder="Ti√™u ƒë·ªÅ (V√≠ d·ª•: Facebook c·ªßa t√¥i)"
                                className="font-semibold text-gray-800 bg-transparent border-none p-0 focus:ring-0 w-full placeholder-gray-400"
                             />
                             <Toggle checked={link.active} onChange={() => handleToggleLink(link.id)} />
                          </div>
                          <input 
                              type="text" 
                              value={link.url}
                              onChange={(e) => handleUpdateLink(link.id, 'url', e.target.value)}
                              placeholder="URL (https://...)"
                              className="text-sm text-gray-500 bg-gray-50 rounded-md px-2 py-1 w-full border-none focus:ring-1 focus:ring-orange-300 transition-all"
                           />
                        </div>
                      </div>
                      <div className="mt-4 pt-3 border-t border-gray-100 flex justify-between items-center text-gray-400">
                         <div className="text-xs flex space-x-3">
                            <button className="hover:text-gray-600 flex items-center space-x-1"><Smartphone size={14}/> <span>Thumbnail</span></button>
                            <button className="hover:text-gray-600 flex items-center space-x-1"><Layout size={14}/> <span>Layout</span></button>
                         </div>
                         <button onClick={() => handleDeleteLink(link.id)} className="text-gray-400 hover:text-red-500 p-1">
                           <Trash2 size={16} />
                         </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* TAB: APPEARANCE */}
            {activeTab === 'appearance' && (
              <div className="space-y-8">
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                  <h3 className="font-bold text-gray-800 mb-4">Themes (Ch·ªß ƒë·ªÅ)</h3>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {/* Theme 1: Default */}
                    <ThemeOption 
                      label="Minimal" 
                      bg="bg-slate-50" 
                      btn="bg-white" 
                      active={theme.background === 'bg-slate-50'}
                      onClick={() => setTheme({...theme, background: 'bg-slate-50', buttonColor: 'bg-white', textColor: 'text-slate-800'})}
                    />
                     {/* Theme 2: Dark Cat */}
                     <ThemeOption 
                      label="M√®o ƒê√™m" 
                      bg="bg-gray-900" 
                      btn="bg-gray-800"
                      textColor="text-white"
                      active={theme.background === 'bg-gray-900'}
                      onClick={() => setTheme({...theme, background: 'bg-gray-900', buttonColor: 'bg-gray-800', textColor: 'text-white'})}
                    />
                    {/* Theme 3: Orange Paw */}
                    <ThemeOption 
                      label="M√®o Cam" 
                      bg="bg-orange-50" 
                      btn="bg-white"
                      textColor="text-orange-900"
                      active={theme.background === 'bg-orange-50'}
                      onClick={() => setTheme({...theme, background: 'bg-orange-50', buttonColor: 'bg-white', textColor: 'text-orange-900'})}
                    />
                     {/* Theme 4: Purple Dream */}
                     <ThemeOption 
                      label="M·ªông M∆°" 
                      bg="bg-indigo-900" 
                      btn="bg-indigo-800"
                      textColor="text-indigo-100"
                      active={theme.background === 'bg-indigo-900'}
                      onClick={() => setTheme({...theme, background: 'bg-indigo-900', buttonColor: 'bg-indigo-800', textColor: 'text-indigo-100'})}
                    />
                  </div>
                </div>

                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                  <h3 className="font-bold text-gray-800 mb-4">Ki·ªÉu d√°ng n√∫t</h3>
                  <div className="flex space-x-4">
                     <ButtonStyleOption label="Vu√¥ng" shape="rounded-none" active={theme.buttonStyle === 'rounded-none'} onClick={() => setTheme({...theme, buttonStyle: 'rounded-none'})} />
                     <ButtonStyleOption label="Bo g√≥c" shape="rounded-xl" active={theme.buttonStyle === 'rounded-xl'} onClick={() => setTheme({...theme, buttonStyle: 'rounded-xl'})} />
                     <ButtonStyleOption label="Tr√≤n" shape="rounded-full" active={theme.buttonStyle === 'rounded-full'} onClick={() => setTheme({...theme, buttonStyle: 'rounded-full'})} />
                  </div>
                </div>
              </div>
            )}
            
            {/* TAB: SETTINGS */}
            {activeTab === 'settings' && (
                <div className="bg-white p-8 rounded-2xl shadow-sm text-center">
                    <Cat size={48} className="mx-auto text-orange-400 mb-4" />
                    <h3 className="font-bold text-xl">Ch√†o m·ª´ng ƒë·∫øn v·ªõi Mewo Alpha!</h3>
                    <p className="text-gray-500 mt-2">ƒê√¢y l√† phi√™n b·∫£n demo giao di·ªán. T√≠nh nƒÉng l∆∞u database s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong phi√™n b·∫£n ti·∫øp theo.</p>
                </div>
            )}

          </div>
        </div>
      </main>

      {/* --- PREVIEW SECTION (DESKTOP: RIGHT SIDE / MOBILE: OVERLAY) --- */}
      <aside className={`
        fixed inset-0 z-50 bg-white md:static md:w-[450px] md:bg-gray-50 md:border-l md:border-gray-200 
        flex items-center justify-center p-4 transition-transform duration-300
        ${mobilePreviewMode ? 'translate-y-0' : 'translate-y-full md:translate-y-0'}
      `}>
         {/* Close Mobile Preview Button */}
         <button 
           onClick={() => setMobilePreviewMode(false)}
           className="absolute top-4 right-4 md:hidden p-2 bg-gray-100 rounded-full"
         >
            <Layout size={24} />
         </button>

         {/* THE PHONE FRAME */}
         <div className="relative w-full max-w-[320px] h-[680px] border-[12px] border-gray-800 rounded-[3rem] bg-gray-800 shadow-2xl overflow-hidden ring-4 ring-gray-100/50">
            {/* Dynamic Content Inside Phone */}
            <div className={`w-full h-full overflow-y-auto hide-scrollbar ${theme.background} ${theme.textColor} transition-colors duration-300`}>
                
                {/* Profile Header */}
                <div className="pt-12 pb-6 px-6 flex flex-col items-center text-center">
                    <div className="relative mb-4">
                        <img 
                            src={profile.avatar} 
                            alt="avatar" 
                            className="w-24 h-24 rounded-full object-cover border-4 border-white/50 shadow-lg" 
                        />
                         {/* Mewo Badge */}
                        <div className="absolute -bottom-1 -right-1 bg-orange-400 text-white p-1 rounded-full border-2 border-white text-xs">
                           üêæ
                        </div>
                    </div>
                    <h1 className="text-lg font-bold leading-tight">{profile.displayName || '@username'}</h1>
                    <p className="mt-2 text-sm opacity-80 leading-relaxed font-medium">{profile.bio}</p>
                    
                    {/* Social Icons (Demo) */}
                    <div className="flex space-x-3 mt-4 opacity-70">
                        <Instagram size={20} />
                        <Facebook size={20} />
                        <Twitter size={20} />
                    </div>
                </div>

                {/* Link List */}
                <div className="px-4 space-y-3 pb-12">
                    {links.filter(l => l.active).map(link => (
                        <a 
                           key={link.id} 
                           href="#" // Prevent navigation in demo
                           className={`
                             block w-full p-4 text-center text-sm font-semibold
                             ${theme.buttonColor} ${theme.buttonStyle}
                             ${theme.background === 'bg-white' ? 'border border-gray-200' : ''}
                             shadow-sm hover:scale-[1.02] active:scale-95
                             transition-all duration-200 group relative overflow-hidden
                           `}
                           style={{ color: 'inherit' }} // Inherit text color from parent
                        >
                           <span className="relative z-10">{link.title || 'Ti√™u ƒë·ªÅ li√™n k·∫øt'}</span>
                           
                           {/* Hover Effect */}
                           <div className="absolute inset-0 bg-current opacity-0 group-hover:opacity-5 transition-opacity" />
                        </a>
                    ))}
                </div>

                {/* Footer */}
                <div className="mt-auto pb-8 text-center opacity-40 hover:opacity-100 transition-opacity">
                   <div className="flex items-center justify-center space-x-1.5">
                      <span className="text-[10px] font-bold uppercase tracking-widest">Powered by</span> 
                      <div className="flex items-center space-x-0.5 font-bold text-sm lowercase">
                        <Cat size={14} strokeWidth={2} />
                        <span>mewo</span>
                      </div>
                   </div>
                </div>

            </div>
            
            {/* Phone Notch/Island */}
            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-1/3 h-6 bg-gray-800 rounded-b-xl z-50"></div>
         </div>
      </aside>

    </div>
  );
}

// --- SUB-COMPONENTS ---

function NavItem({ icon, label, active, onClick }) {
  return (
    <button 
      onClick={onClick}
      className={`
        flex flex-col md:flex-row items-center md:space-x-3 p-3 rounded-xl transition-all
        ${active ? 'bg-orange-50 text-orange-600' : 'text-gray-500 hover:bg-gray-50 hover:text-gray-800'}
      `}
    >
      <div className={`${active ? 'text-orange-500' : ''}`}>{icon}</div>
      <span className={`text-xs md:text-sm font-medium ${active ? 'font-bold' : ''}`}>{label}</span>
    </button>
  );
}

function ThemeOption({ label, bg, btn, textColor, active, onClick }) {
    return (
        <button onClick={onClick} className="text-left group">
            <div className={`
               h-32 rounded-xl border-2 transition-all overflow-hidden relative shadow-sm
               ${active ? 'border-orange-500 ring-2 ring-orange-200' : 'border-gray-200 group-hover:border-gray-300'}
            `}>
                <div className={`w-full h-full ${bg} flex flex-col items-center justify-center p-3 space-y-2`}>
                    <div className="w-8 h-8 rounded-full bg-current opacity-20" />
                    <div className={`w-full h-3 ${btn} rounded-md opacity-80`} />
                    <div className={`w-full h-3 ${btn} rounded-md opacity-60`} />
                </div>
                {active && (
                   <div className="absolute top-2 right-2 bg-orange-500 text-white p-1 rounded-full shadow-sm">
                      <Check size={12} />
                   </div>
                )}
            </div>
            <p className="mt-2 text-sm font-medium text-gray-700 text-center">{label}</p>
        </button>
    )
}

function ButtonStyleOption({ label, shape, active, onClick }) {
    return (
        <button 
          onClick={onClick}
          className={`
            flex-1 py-3 border-2 text-sm font-medium transition-all
            ${shape}
            ${active ? 'border-orange-500 bg-orange-50 text-orange-700' : 'border-gray-200 bg-white hover:border-gray-300'}
          `}
        >
            {label}
        </button>
    )
}
